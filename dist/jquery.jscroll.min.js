/*!
 * jScroll - jQuery Plugin for Infinite Scrolling / Auto-Paging
 * @see @link{https://jscroll.com}
 *
 * @copyright Philip Klauzinski
 * @license Dual licensed under the MIT and GPL Version 2 licenses
 * @author Philip Klauzinski (https://webtopian.com)
 * @version 2.4.1
 * @requires jQuery v1.8.0+
 * @preserve
 */
!function(m){"use strict";m.jscroll={defaults:{debug:!1,autoTrigger:!0,autoTriggerUntil:!1,loadingHtml:"<small>Loading...</small>",optional_class:"",loadingFunction:!1,padding:0,nextSelector:"a:last",contentSelector:"",pagingSelector:"",callback:!1}};var o=function(a,l){var n,t=a.data("jscroll"),o="function"==typeof l?{callback:l}:l,s=m.extend({},m.jscroll.defaults,o,t||{}),d="visible"===a.css("overflow-y"),e=a.find(s.nextSelector).first(),r=m(window),i=m("body"),f=d?r:a,c=m.trim(e.prop("href")+" "+s.contentSelector),g=function(){var l=s.optional_class+" ";""!==l?a.find(".jscroll-inner").length||a.contents().wrapAll('<div class="'+l+'jscroll-inner" />'):a.find(".jscroll-inner").length||a.contents().wrapAll('<div class="jscroll-inner" />')},p=function(l){s.pagingSelector?l.closest(s.pagingSelector).hide():l.parent().not(".jscroll-inner,.jscroll-added").addClass("jscroll-next-parent").hide().length||l.wrap('<div class="jscroll-next-parent" />').parent().hide()},u=function(){return f.unbind(".jscroll").removeData("jscroll").find(".jscroll-inner").children().unwrap().filter(".jscroll-added").children().unwrap()},j=function(){if(a.is(":visible")){g();var l=a.find("div.jscroll-inner").first(),n=a.data("jscroll"),t=parseInt(a.css("borderTopWidth"),10),o=isNaN(t)?0:t,e=parseInt(a.css("paddingTop"),10)+o,r=d?f.scrollTop():a.offset().top,i=l.length?l.offset().top:0,c=Math.ceil(r-i+f.height()+e);if(!n.waiting&&c+s.padding>=l.outerHeight())return b("info","jScroll:",l.outerHeight()-c,"from bottom. Loading next request..."),v()}},h=function(){var l=a.find(s.nextSelector).first();if(l.length)if(s.autoTrigger&&(!1===s.autoTriggerUntil||0<s.autoTriggerUntil)){p(l);var n=i.height()-a.offset().top;(a.height()<n?a.height():n)<=(0<a.offset().top-r.scrollTop()?r.height()-(a.offset().top-m(window).scrollTop()):r.height())&&j(),f.unbind(".jscroll").bind("scroll.jscroll",function(){return j()}),0<s.autoTriggerUntil&&s.autoTriggerUntil--}else f.unbind(".jscroll"),l.bind("click.jscroll",function(){return p(l),v(),!1})},v=function(){var l=a.find("div.jscroll-inner").first(),r=a.data("jscroll");return r.waiting=!0,l.append('<div class="jscroll-added" />').children(".jscroll-added").last().html('<div class="jscroll-loading" id="jscroll-loading">'+s.loadingHtml+"</div>").promise().done(function(){s.loadingFunction&&s.loadingFunction()}),a.animate({scrollTop:l.outerHeight()},0,function(){var e=r.nextHref;l.find("div.jscroll-added").last().load(e,function(l,n){if("error"===n)return u();var t,o=m(this).find(s.nextSelector).first();r.waiting=!1,r.nextHref=!!o.prop("href")&&m.trim(o.prop("href")+" "+s.contentSelector),m(".jscroll-next-parent",a).remove(),(t=t||a.data("jscroll"))&&t.nextHref?h():(b("warn","jScroll: nextSelector not found - destroying"),u()),s.callback&&s.callback.call(this,e),b("dir",r)})})},b=function(l){if(s.debug&&"object"==typeof console&&("object"==typeof l||"function"==typeof console[l]))if("object"==typeof l){var n=[];for(var t in l)"function"==typeof console[t]?(n=l[t].length?l[t]:[l[t]],console[t].apply(console,n)):console.log.apply(console,n)}else console[l].apply(console,Array.prototype.slice.call(arguments,1))};return a.data("jscroll",m.extend({},t,{initialized:!0,waiting:!1,nextHref:c})),g(),(n=m(s.loadingHtml).filter("img").attr("src"))&&((new Image).src=n),h(),m.extend(a.jscroll,{destroy:u}),a};m.fn.jscroll=function(t){return this.each(function(){var l=m(this),n=l.data("jscroll");n&&n.initialized||o(l,t)})}}(jQuery);
